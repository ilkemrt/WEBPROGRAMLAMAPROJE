@model IEnumerable<WEBPROJE1.Models.Randevu>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

@if (User.IsInRole("Uye"))
{
    <p>
        <a asp-action="Create" class="btn btn-primary">Yeni Randevu Al</a>
    </p>
}
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.RandevuTarihi)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.OlusturulmaTarihi)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Durum)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Uye)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Antrenor)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Hizmet)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr class="@(item.Durum == WEBPROJE1.Models.RandevuDurumu.IptalEdildi ? "table-danger" : "")">

                <td>@item.RandevuTarihi.ToString("dd.MM.yyyy HH:mm")</td>
                <td>@item.Antrenor.TamAd</td>
                <td>@item.Hizmet.Ad</td>
                <td>
                    @* Üye adını sadece Admin görsün *@
                    @if (User.IsInRole("Admin"))
                    {
                        <span class="badge bg-info text-dark">@item.Uye?.Ad @item.Uye?.Soyad</span>
                    }
                    else
                    {
                        <span>Ben</span>
                    }
                </td>
                <td>
                    @* Durumu Renkli Gösterelim *@
                    @if (item.Durum == WEBPROJE1.Models.RandevuDurumu.Beklemede)
                    {
                        <span class="badge bg-warning text-dark">Beklemede</span>
                    }
                    else if (item.Durum == WEBPROJE1.Models.RandevuDurumu.Onaylandi)
                    {
                        <span class="badge bg-success">Onaylandı</span>
                    }
                    else if (item.Durum == WEBPROJE1.Models.RandevuDurumu.IptalEdildi)
                    {
                        <span class="badge bg-danger">İptal Edildi</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">Tamamlandı</span>
                    }
                </td>
                <td>
                    @* ADMİN BUTONLARI *@
                    @if (User.IsInRole("Admin") && item.Durum == WEBPROJE1.Models.RandevuDurumu.Beklemede)
                    {
                        <a asp-action="Onayla" asp-route-id="@item.Id" class="btn btn-sm btn-success">✔ Onayla</a>
                    }

                    @* İPTAL BUTONU (Henüz iptal edilmemişse göster) *@
                    @if (item.Durum != WEBPROJE1.Models.RandevuDurumu.IptalEdildi)
                    {
                        <a asp-action="IptalEt" asp-route-id="@item.Id" class="btn btn-sm btn-danger">X İptal</a>
                    }
                </td>
            </tr>
        }

    </tbody>
</table>
